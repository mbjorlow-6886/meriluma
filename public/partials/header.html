<script>
// ========== Global Header Logic (MeriLuma) ==========
(function(){
  const tryInit = () => {
    const header = document.querySelector('.site-header');
    const nav = document.getElementById('primary-nav');
    const toggle = document.querySelector('.nav-toggle');
    if (!header || !nav || !toggle) return false;

    // Unngå dobbel binding:
    if (!toggle.dataset.bound) {
      toggle.addEventListener('click', () => {
        const open = nav.classList.toggle('open');
        toggle.setAttribute('aria-expanded', String(open));
      });
      toggle.dataset.bound = '1';
    }

    // Aktiv lenke (markerer siden du står på)
    const path = location.pathname.replace(/index\.html$/, '').toLowerCase();
    document.querySelectorAll('#primary-nav a[data-match]').forEach(a => {
      const match = a.getAttribute('data-match').toLowerCase();
      if (path === '/' && match === '/') a.classList.add('active');
      else if (path.startsWith(match) && match !== '/') a.classList.add('active');
    });

    // Legg til skygge ved scroll
    const onScroll = () => {
      if (window.scrollY > 4) header.classList.add('scrolled');
      else header.classList.remove('scrolled');
    };
    onScroll();
    window.addEventListener('scroll', onScroll, { passive: true });
    return true;
  };

  if (tryInit()) return;

  document.addEventListener('DOMContentLoaded', tryInit);
  const mo = new MutationObserver(() => { if (tryInit()) mo.disconnect(); });
  mo.observe(document.documentElement, { childList: true, subtree: true });
})();
</script>
